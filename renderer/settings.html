<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <title>è®¾ç½®</title>
    <style>
      body {
        font-family: sans-serif;
        margin: 18px;
      }
      label {
        display: block;
        margin-top: 14px;
      }
      input {
        width: 100%;
        padding: 6px 8px;
      }
      button {
        margin-top: 20px;
        padding: 6px 24px;
      }
    </style>
  </head>
  <body>
    <h2>å…¨å±€è®¾ç½®</h2>

    <label
      >API Base URL
      <input id="apiBase" placeholder="https://your.api" />
    </label>

    <label
      >API Token
      <input id="apiToken" placeholder="å¯ç•™ç©º" />
    </label>

    <label
      >ç”µè´¹ç”¨æˆ·å
      <input id="elecUser" />
    </label>

    <label
      >ç”µè´¹å¯†ç 
      <input id="elecPass" type="password" />
    </label>

    <button id="saveBtn">ğŸ’¾ ä¿å­˜</button>

    <script>
      // åˆå§‹åŒ–
      (async () => {
        const cfg = await window.settings.getAll();
        for (const [k, v] of Object.entries(cfg)) {
          const input = document.getElementById(k);
          if (input && v) input.value = v;
        }
      })();

      // ä¿å­˜
      document.getElementById("saveBtn").onclick = async () => {
        const data = {
          apiBase: apiBase.value.trim(),
          apiToken: apiToken.value.trim(),
          elecUser: elecUser.value.trim(),
          elecPass: elecPass.value.trim(),
        };

        // 1ï¸âƒ£ å†™å…¥æœ¬åœ°
        await window.settings.setAll(data);

        // 2ï¸âƒ£ ä¸»è¿›ç¨‹ä¹ŸåŒæ­¥ä¸€ä¸‹ Base URLï¼Œä¿æŒä¸é¦–é¡µä¸€è‡´
        await window.api.setApiBase(data.apiBase);

        // 3ï¸âƒ£ ç«‹å³åšä¸€æ¬¡ /words æ¢æ´»
        try {
          await window.api.getWords(); // â† çœŸè¯·æ±‚
          alert("âœ… é…ç½®å·²ä¿å­˜ï¼ŒAPI è¿æ¥æ­£å¸¸ï¼");
        } catch (e) {
          alert("âš ï¸ é…ç½®å·²ä¿å­˜ï¼Œä½† API æ— æ³•è¿æ¥ï¼š\n" + e.message);
        }
      };
    </script>
  </body>
</html>
