<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="./index.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>
  <body style="padding-top: 36px">
    <div class="titlebar">
      <div class="window-controls">
        <div
          class="btn min"
          onclick="window.api.winControl('minimize')"
          data-tooltip="最小化"
        ></div>
        <div
          class="btn max"
          onclick="window.api.winControl('maximize')"
          data-tooltip="最大化"
        ></div>
        <div
          class="btn close"
          onclick="window.api.winControl('close')"
          data-tooltip="关闭"
        ></div>
      </div>
    </div>

    <!-- 添加生词页 -->
    <div id="view-input" class="view">
      <div class="input-wrapper">
        <h2>添加生词</h2>
        <div class="form-group">
          <label for="en">英文单词</label>
          <input id="en" placeholder="如：apple" />
        </div>
        <div class="form-group">
          <label for="zh">中文释义</label>
          <input id="zh" placeholder="如：苹果" />
        </div>
        <button id="saveBtn"><i class="fa fa-save"></i> 保存词条</button>
      </div>
    </div>

    <!-- 展示词汇页 -->
    <div id="view-display" class="view active">
      <h2>生词本</h2>
      <input id="search" placeholder="搜索中/英文" />
      <ul id="results"></ul>
      <div id="context-menu">
        <button onclick="deleteWord()">删除词条</button>
        <button onclick="editWord()">修改词条</button>
      </div>
    </div>

    <!-- 设置页 -->
    <div id="view-settings" class="view">
      <h2>设置</h2>
      <p>你可以在这里添加设置项</p>
    </div>

    <!-- 底部导航 -->
    <div class="bottom-nav">
      <button onclick="switchView('input')">
        <i class="fa-solid fa-plus"></i>
      </button>
      <button class="active" onclick="switchView('display')">
        <i class="fa-solid fa-list"></i>
      </button>
      <button onclick="switchView('settings')">
        <i class="fa-solid fa-gear"></i>
      </button>
    </div>

    <!-- 编辑模态框 -->
    <div id="edit-modal" class="modal">
      <div class="modal-content">
        <h3>修改词条</h3>
        <p>英文</p>
        <input id="edit-en" placeholder="英文" />
        <p>中文</p>
        <input id="edit-zh" placeholder="中文" />
        <div class="modal-actions">
          <button onclick="confirmEdit()">保存</button>
          <button onclick="closeModal()">取消</button>
        </div>
      </div>
    </div>

    <!-- JS 脚本 -->
    <script>
      let allWords = [];
      let selectedWord = null;

      function switchView(view) {
        document
          .querySelectorAll(".view")
          .forEach((div) => div.classList.remove("active"));
        document.querySelector(`#view-${view}`).classList.add("active");

        document
          .querySelectorAll(".bottom-nav button")
          .forEach((btn) => btn.classList.remove("active"));
        event.currentTarget.classList.add("active");

        if (view === "display") {
          loadWords();
          document.getElementById("search").value = "";
        }
      }

      async function saveWord() {
        const en = document.getElementById("en").value.trim();
        const zh = document.getElementById("zh").value.trim();
        if (en && zh) {
          await window.api.saveWord({ en, zh });
          document.getElementById("en").value = "";
          document.getElementById("zh").value = "";
        }
      }

      async function loadWords() {
        allWords = await window.api.getWords();
        renderList(allWords);
      }

      function renderList(words) {
        const list = document.getElementById("results");
        list.innerHTML = "";
        words.forEach((w) => {
          const li = document.createElement("li");
          li.className = "entry";
          li.innerHTML = `<span>${w.en}</span><span>${w.zh}</span>`;
          li.addEventListener("contextmenu", (e) => {
            e.preventDefault();
            selectedWord = w;
            const menu = document.getElementById("context-menu");
            menu.style.top = `${e.pageY}px`;
            menu.style.left = `${e.pageX}px`;
            menu.style.display = "block";
          });
          list.appendChild(li);
        });
      }

      document.addEventListener("click", () => {
        document.getElementById("context-menu").style.display = "none";
      });

      document.getElementById("search").addEventListener("input", async (e) => {
        const kw = e.target.value.trim();
        if (!kw) return renderList(allWords);
        const filtered = await window.api.searchWord(kw);
        renderList(filtered);
      });

      function deleteWord() {
        if (selectedWord) {
          window.api.deleteWord(selectedWord.id).then(() => {
            loadWords();
            selectedWord = null;
          });
        }
      }

      function editWord() {
        if (selectedWord) {
          document.getElementById("edit-en").value = selectedWord.en;
          document.getElementById("edit-zh").value = selectedWord.zh;
          document.getElementById("edit-modal").style.display = "flex";
        }
      }

      function confirmEdit() {
        const newEn = document.getElementById("edit-en").value.trim();
        const newZh = document.getElementById("edit-zh").value.trim();
        if (newEn && newZh && selectedWord) {
          window.api
            .updateWord({ id: selectedWord.id, en: newEn, zh: newZh })
            .then(() => {
              loadWords();
              closeModal();
              selectedWord = null;
            });
        }
      }

      function closeModal() {
        document.getElementById("edit-modal").style.display = "none";
      }

      loadWords();
      document.getElementById("saveBtn").addEventListener("click", saveWord);
    </script>
  </body>
</html>
